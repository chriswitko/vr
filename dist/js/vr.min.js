!function(e,t){top!=self&&top.location.replace(self.location.href);var a=e(t),r=e("body"),i=e(document),o={ensureValidProtocol:function(e,t){var a=e.val().substring(0,4),r=e.parent(),i=new RegExp("://");r.removeClass("error"),i.test(e.val())&&"http"!=a&&(e.focus().select(),r.addClass("error"),t.stopPropagation(),t.preventDefault())},createBookmarklet:function(){var e,a=document.title,r=t.location.href;t.sidebar?t.sidebar.addPanel(a,r):t.external?t.external.AddFavorite(r,a):t.opera&&t.print&&(e=document.createElement("a"),e.setAttribute("href",r),e.setAttribute("title",a),e.setAttribute("rel","sidebar"),e.click())},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),a=t.exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))},init:function(){delete this.init,e('[rel="bookmark"]').attr("href","javascript:document.location='"+document.location+"?url=' + document.location.href;"),this.$frame=e("#vrFrame"),this.initUA(),c(),this.toggleSiteLoader(!0),this.parseUrl(),this.parseAddrBar(),n(this.getDeviceFromUrl())},parseUrl:function(t){var a=this.url=this.getParameterByName("url"),r=(new Date).getTime();a.length>0?("http"!=a.substr(0,4)&&(a="http://"+a),this.url=a,e('[name="url"]').val(this.url),t===!0&&(a=a.indexOf("?")>0?a+"&vrt="+r:a+"?vrt="+r),this.showLoader(),this.$frame.attr("src",a),e("#vrPage").removeClass("hidden")):(e("#indexPage").removeClass("hidden"),e("#ribbon-wrapper").removeClass("hidden"))},parseAddrBar:function(){{var t=this.getParameterByName("addrbar");e("#toolbar")}t="1"===t?"1":"0",document.getElementById("iptAddrBar").value=t,"1"===t&&this.toggleAddressBar()},getDeviceFromUrl:function(){var e=this.getParameterByName("device");return document.getElementById("iptDevice").value=e,e},showLoader:function(){this.$frame.addClass("invisible"),this.toggleSiteLoader(!1)},hideLoader:function(){this.$frame.removeClass("invisible"),this.toggleSiteLoader(!0)},toggleAddressBar:function(){e("#toolbar").toggleClass("open"),e("[data-addrtoggle]").toggleClass("open")},toggleSiteLoader:function(t){t===!0?e("#siteLoader").addClass("hidden").removeClass("animate-rotate360"):e("#siteLoader").removeClass("hidden").addClass("animate-rotate360")},initUA:function(){var t=navigator.userAgent;e(".desktop-only").attr("data-user-agent",t)},setUA:function(e,t){if("string"==typeof e&&(e=document.querySelector("#"+e).contentWindow),e.navigator.userAgent!=t){var a={get:function(){return t}};try{Object.defineProperty(e.navigator,"userAgent",a)}catch(r){e.navigator=Object.create(navigator,{userAgent:a})}}}},n=function(t){var a=e.cookie("vr-device"),r=e.cookie("vr-orientation");a=""===t?a:t,a=a||"iphone5",a&&e('[data-device="'+a+'"]').trigger("click"),"landscape"===r&&e("#btnToggleRotate").trigger("click")},c=function(){var t=e("button[data-viewport-width]"),n=o.$frame,c=e("button[data-rotate=true]"),s=e("#vr"),d=function(){e("#closeResizer").length>0?l():document.location=document.getElementById("btnVRClose").getAttribute("href")},l=function(){var e=a.width(),r=a.height();t.removeClass("active"),n.css({"max-width":e,"max-height":r}),s.fadeOut(500,function(){document.location=n[0].contentWindow.location.href})};n.on("load",function(e){o.hideLoader()}),r.on("click","button[data-viewport-width]",function(a){var r=this.getAttribute("data-viewport-width"),i=this.getAttribute("data-viewport-height"),c=e(this),s=this.getAttribute("data-device"),d=this.getAttribute("data-user-agent");return t.removeClass("active"),c.addClass("active"),e.cookie("vr-device",s),n.css({"max-width":r,"max-height":i}),o.setUA(n[0].id,d),console.log("ua",d),a.preventDefault(),!1}).on("click","button.rotate",function(t){c.each(function(){var t=e(this).toggleClass("landscape"),a=t.attr("data-viewport-width"),r=t.attr("data-viewport-height");t.attr("data-viewport-width",r),t.attr("data-viewport-height",a),t.hasClass("active")&&(t.trigger("click"),t.hasClass("landscape")?e.cookie("vr-orientation","landscape"):e.removeCookie("vr-orientation"))})}).on("click","button.refresh",function(e){o.parseUrl(!0)}).on("click","#closeResizer",function(e){l()}).on("click","[data-addrtoggle]",function(t){var a=(e(this),e(this.getAttribute("data-toggle")));o.toggleAddressBar(),a.hasClass("open")&&a.find('[name="url"]').focus().select()}).on("keyup","input",function(t){27==t.keyCode&&(e("[data-toggle]").first().trigger("click"),e('[name="url"]').val(o.url)),t.stopPropagation()}).on("keypress",'[name="url"]',function(t){13==t.keyCode&&o.ensureValidProtocol(e(this),t)}).on("click",'button[type="submit"]',function(t){o.ensureValidProtocol(e(this).parents("form").find('[name="url"]'),t)}).on("click",'[rel="bookmark"]',function(e){return e.preventDefault(),!1}),i.on("keyup",function(t){switch(t.keyCode){case 27:e("[data-toggle]").first().trigger("click");break;case 49:e('[data-device="fullscreen"]').trigger("click");break;case 50:e('[data-device="desktop"]').trigger("click");break;case 51:e('[data-device="macbook"]').trigger("click");break;case 52:e('[data-device="iPadMini"]').trigger("click");break;case 53:e('[data-device="iphone6+"]').trigger("click");break;case 54:e('[data-device="iphone6"]').trigger("click");break;case 55:e('[data-device="iphone5"]').trigger("click");break;case 32:case 56:case 82:e(".rotate").trigger("click");break;case 88:d()}}),e("form").on("submit",function(t){var a=e(this).find(['name="url"']),r=a.parent();return r.removeClass("error"),""===a.val()?(r.addClass("error"),t.preventDefault(),t.stopPropagation(),!1):void 0})};e(function(){o.init()})}(jQuery,window);
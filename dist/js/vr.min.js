!function(e,t){top!=self&&top.location.replace(self.location.href);var r=e(t),a=e("body"),i=e(document),o={ensureValidProtocol:function(e,t){var r=e.val().substring(0,4),a=e.parent(),i=new RegExp("://");a.removeClass("error"),i.test(e.val())&&"http"!=r&&(e.focus().select(),a.addClass("error"),t.stopPropagation(),t.preventDefault())},createBookmarklet:function(){var e,r=document.title,a=t.location.href;t.sidebar?t.sidebar.addPanel(r,a):t.external?t.external.AddFavorite(a,r):t.opera&&t.print&&(e=document.createElement("a"),e.setAttribute("href",a),e.setAttribute("title",r),e.setAttribute("rel","sidebar"),e.click())},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=t.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))},init:function(){delete this.init,this.hideOnMobile()||(e('[rel="bookmark"]').attr("href","javascript:document.location='"+document.location+"?url='document.location.href;"),this.$frame=e("#vrFrame"),this.device=this.getDeviceFromCookie(this.getDeviceFromUrl()),this.initUA(),n(),this.toggleSiteLoader(!0),this.parseUrl(),this.parseAddrBar(),this.restore(this.device))},hideOnMobile:function(){var e=this.getParameterByName("mobi"),t=this.getParameterByName("url"),r=/mobile/i.test(navigator.userAgent);return"0"===e&&r&&t.length>0?(location.href=t,!0):!1},parseUrl:function(t){var r=this.url=this.getParameterByName("url"),a=(new Date).getTime(),i=this.device.ua;r.length>0?("http"!=r.substr(0,4)&&(r="http://"+r),this.url=r,e('[name="url"]').val(this.url),t===!0&&(r=r.indexOf("?")>0?r+"&vrt="+a:r+"?vrt="+a),this.showLoader(),e("#btnVRClose").attr("href",r),this.setUA(this.$frame[0].id,i),this.$frame.attr("src",r),e("#vrPage").removeClass("hidden")):(e("#indexPage").removeClass("hidden"),e("#ribbon-wrapper").removeClass("hidden"))},parseAddrBar:function(){{var t=this.getParameterByName("addrbar");e("#toolbar")}t="1"===t?"1":"0",document.getElementById("iptAddrBar").value=t,"1"===t&&this.toggleAddressBar()},getDeviceFromUrl:function(){var e=this.getParameterByName("device");return document.getElementById("iptDevice").value=e,e},getDeviceFromCookie:function(t){var r=e.cookie("vr-device"),a=e.cookie("vr-orientation");return r=""===t?r:t,r=r||"iphone5",{id:r,orient:a}},restore:function(t){e('[data-device="'+t.id+'"]').trigger("click"),"landscape"===t.orient&&e("#btnToggleRotate").trigger("click")},showLoader:function(){this.$frame.addClass("invisible"),this.toggleSiteLoader(!1)},hideLoader:function(){this.$frame.removeClass("invisible"),this.toggleSiteLoader(!0)},toggleAddressBar:function(){e("#toolbar").toggleClass("open"),e("[data-addrtoggle]").toggleClass("open")},toggleSiteLoader:function(t){t===!0?e("#siteLoader").addClass("hidden").removeClass("animate-rotate360"):e("#siteLoader").removeClass("hidden").addClass("animate-rotate360")},initUA:function(){var t=navigator.userAgent;e(".desktop-only").attr("data-user-agent",t),this.device.ua=t},setUA:function(e,t){{var r;this.url.indexOf(location.host)>-1}"string"==typeof e&&(e=document.querySelector("#"+e).contentWindow);try{r=e.navigator}catch(a){console.log(a),r=null}if(r&&r.userAgent!=t){var i={get:function(){return t}};try{Object.defineProperty(r,"userAgent",i)}catch(a){e.navigator=Object.create(r,{userAgent:i})}}},refresh:function(){this.parseUrl(!0)}},n=function(){var n=e("button[data-viewport-width]"),s=o.$frame,c=e("button[data-rotate=true]"),d=e("#vr"),l=function(e){var t=r.width(),a=r.height();n.removeClass("active"),s.css({"max-width":t,"max-height":a}),d.fadeOut(500,function(){document.location.href=e})};s.on("load",function(e){o.hideLoader(),t.postMessage(o.device,"*")}),a.on("click","button[data-viewport-width]",function(t){var r=this.getAttribute("data-viewport-width"),a=this.getAttribute("data-viewport-height"),i=e(this),c=this.getAttribute("data-device"),d=this.getAttribute("data-user-agent");return o.device.ua=d,o.device.id=c,n.removeClass("active"),i.addClass("active"),e.cookie("vr-device",c),s.css({"max-width":r,"max-height":a}),o.setUA(s[0].id,d),t.preventDefault(),!1}).on("click",".rotate",function(t){c.each(function(){var t=e(this).toggleClass("landscape"),r=t.attr("data-viewport-width"),a=t.attr("data-viewport-height");t.attr("data-viewport-width",a),t.attr("data-viewport-height",r),t.hasClass("active")&&(t.trigger("click"),t.hasClass("landscape")?(e.cookie("vr-orientation","landscape"),o.device.orient="landscape"):(o.device.orient="portrait",e.removeCookie("vr-orientation")))})}).on("click",".refresh",function(e){o.refresh()}).on("click",".close",function(e){return l(o.url),!1}).on("click","[data-addrtoggle]",function(t){var r=(e(this),e(this.getAttribute("data-toggle")));o.toggleAddressBar(),r.hasClass("open")&&r.find('[name="url"]').focus().select()}).on("keyup","input",function(t){27==t.keyCode&&(e("[data-toggle]").first().trigger("click"),e('[name="url"]').val(o.url)),t.stopPropagation()}).on("keypress",'[name="url"]',function(t){13==t.keyCode&&o.ensureValidProtocol(e(this),t)}).on("click",'button[type="submit"]',function(t){o.ensureValidProtocol(e(this).parents("form").find('[name="url"]'),t)}).on("click",'[rel="bookmark"]',function(e){return e.preventDefault(),!1}),i.on("keyup",function(t){switch(t.keyCode){case 27:e("[data-toggle]").first().trigger("click");break;case 49:e('[data-device="fullscreen"]').trigger("click");break;case 50:e('[data-device="desktop"]').trigger("click");break;case 51:e('[data-device="macbook"]').trigger("click");break;case 52:e('[data-device="iPadMini"]').trigger("click");break;case 53:e('[data-device="iphone6+"]').trigger("click");break;case 54:e('[data-device="iphone6"]').trigger("click");break;case 55:e('[data-device="iphone5"]').trigger("click");break;case 32:case 56:case 82:e(".rotate").trigger("click");break;case 88:l(o.url)}}),e("form").on("submit",function(t){var r=e(this).find(['name="url"']),a=r.parent();return a.removeClass("error"),""===r.val()?(a.addClass("error"),t.preventDefault(),t.stopPropagation(),!1):void 0})};e(function(){o.init()})}(jQuery,window);